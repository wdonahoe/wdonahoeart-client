function getImageUrls2(a){return a.getImageUrls()}function getDrawing(a,b){return a.getDrawing(b.id)}function getImageUrls(a,b){var c="color"===b.gallery?"color":"bw";return a.getImageUrls(c)}var app=angular.module("wdonahoeart",["wdonahoeart.home","wdonahoeart.login","wdonahoeart.jwtAuth","wdonahoeart.admin","wdonahoeart.gallery","wdonahoeart.text","wdonahoeart.landing","wdonahoeart.contact"]);app.constant("API_URL","http://localhost:8080/api").config(["$urlRouterProvider","$httpProvider",function(a,b){a.otherwise("/"),b.interceptors.push("jwtAuthInterceptor")}]).filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]).run(["$rootScope","jwtAuthFactory",function(a,b){a.$on("$stateChangeStart",function(a,c){c.data&&c.data.requiresLogin&&(b.isAuthed()||(a.preventDefault(),$state.go("login")))})}]).factory("jwtAuthInterceptor",["$q","$injector","jwtAuthFactory","API_URL",function(a,b,c,d){return{request:function(a){var b=c.getToken();return 0===a.url.indexOf(d)&&b&&(a.headers.authorization="Bearer "+b),a},response:function(a){return 0===a.config.url.indexOf(d)&&a.data.id_token&&c.storeToken(a.data.id_token,a.data.user),a},responseError:function(c){return 401===c.status?(b.get("$state").go("login"),a.reject(c)):a.reject(c)}}}]).controller("AppCtrl",["$scope","$state","jwtAuthFactory","$location","$rootScope",function(a,b,c,d,e){this.isAuthed=function(){return c.isAuthed()},this.logout=function(){c.destroyAuth(),b.go("home")},(""==d.url()||"/"==d.url())&&(b.go("landing"),a.landing=!0),e.$on("$stateChangeStart",function(b,c,d,e){"landing"===e.name?a.transitioning=!0:a.transitioning=!1,"landing"===c.name?a.landing=!0:a.landing=!1})}]);var admin=angular.module("wdonahoeart.admin",["ngResource","ui.router","dndLists","wdonahoeart.fileReader"]);getImageUrls2.$inject=["apiFactory"],getDrawing.$inject=["apiFactory","$stateParams"],admin.config(["$stateProvider",function(a){a.state("admin",{"abstract":!0,url:"/admin",templateUrl:"components/admin/admin.html",data:{requiresLogin:!0}}).state("admin.upload",{url:"",templateUrl:"components/admin/partials/admin.upload.html",controller:"UploadCtrl"}).state("admin.edit",{url:"/edit",templateUrl:"components/admin/partials/admin.edit.html",resolve:{drawings:getImageUrls2},controller:["drawings","apiFactory","$state",function(a,b,c){this.drawings=a.data,this.orig=this.drawings,this.reorder=function(){var a=this;return _.every(a.drawings,a.orig)?!1:void b.reorderDrawings(a.drawings).then(function(b){_.every(a.drawings.bw,a.orig.bw)?c.go("gallery.views",{gallery:"color"}):c.go("gallery.views",{gallery:"shades-of-gray"})})}}],controllerAs:"ctrl"}).state("admin.edit-drawing",{url:"/edit/{id}",templateUrl:"components/admin/partials/admin.edit-drawing.html",resolve:{drawing:getDrawing},controller:["drawing","$scope","apiFactory","fileReaderFactory","$timeout","$state",function(a,b,c,d,e,f){var g=this;g.drawing=a.data,g.imgSrc=g.drawing.url;var h=["title","medium","width","height","isBw"];g.allFilled=function(){var a=_.keys(g.drawing);return!_.isEmpty(_.difference(h,a))},g.getFile=function(){d.readAsDataURL(b.file,b).then(function(a){g.imgSrc=a})},g.upload=function(){b.loading=!0,c.editDrawing(b.file,g.drawing).then(function(a){e(function(){g.myForm.$setPristine();var b=a.data.isBw?"shades-of-gray":"color";f.go("gallery.views",{gallery:b})},500)},function(a){console.log(a)})}}],controllerAs:"ctrl"})}]).directive("editList",function(){return{restrict:"E",scope:{},bindToController:{drawings:"="},templateUrl:"components/admin/partials/admin.edit-list.html",controller:["apiFactory","$state",function(a,b){}],controllerAs:"ctrl"}}),admin.controller("UploadCtrl",["apiFactory","fileReaderFactory","$scope","$timeout","$state",function(a,b,c,d,e){var f=this,g=["title","medium","width","height","isBw"],h=!1;f.imgSrc,f.allFilled=function(){var a=_.keys(f.data);return!(_.isEmpty(_.difference(g,a))&&c.file)},f.getFile=function(){b.readAsDataURL(c.file,c).then(function(a){f.imgSrc=a})},f.upload=function(){c.loading=!0,a.uploadS3(c.file,f.data).then(function(a){d(function(){f.myForm.$setPristine(),f.data={},h=!0;var b=a.data.isBw?"shades-of-gray":"color";e.go("gallery.views",{gallery:b})},500)},function(a){console.log(a)})}}]),angular.module("wdonahoeart.api",[]).factory("apiFactory",["$http","API_URL",function(a,b){var c={};return c.login=function(c){return a({method:"POST",url:b+"/login",data:c})},c.uploadS3=function(c,d){return a.post(b+"/upload_s3",{file:c,fileData:d},{transformRequest:function(a){var b=new FormData;return b.append("data",JSON.stringify(a.fileData)),b.append("file",a.file),b},headers:{"Content-Type":void 0}})},c.editDrawing=function(c,d){return a.put(b+"/drawing/"+d._id,{file:c?c:void 0,drawing:_.omit(d,"dimensions")},{transformRequest:function(a){var b=new FormData;return b.append("drawing",JSON.stringify(a.drawing)),b.append("file",a.file),b},headers:{"Content-Type":void 0}})},c.reorderDrawings=function(c){return a({method:"POST",url:b+"/drawings/reorder",data:{bw:c.bw,color:c.color}})},c.getImageUrls=function(c){if(void 0===c)var c="all";return a({method:"GET",url:b+"/drawings/"+c,cached:!0})},c.getDrawing=function(c){return a({method:"GET",url:b+"/drawing/"+c})},c}]),angular.module("wdonahoeart.contact",["ui.router"]).config(["$stateProvider",function(a){a.state("contact",{url:"/contact",templateUrl:"components/contact/contact.html"})}]),angular.module("wdonahoeart.fileReader",[]).factory("fileReaderFactory",["$q","$log",function(a,b){var c=function(a,b,c){return function(){c.$apply(function(){b.resolve(a.result)})}},d=function(a,b,c){return function(){c.$apply(function(){b.reject(a.result)})}},e=function(a,b){return function(a){b.$broadcast("fileProgress",{total:a.total,loaded:a.loaded})}},f=function(a,b){var f=new FileReader;return f.onload=c(f,a,b),f.onerror=d(f,a,b),f.onprogress=e(f,b),f},g=function(b,c){var d=a.defer(),e=f(d,c);return e.readAsDataURL(b),d.promise};return{readAsDataURL:g}}]);var gallery=angular.module("wdonahoeart.gallery",["ngResource","ui.router"]);getImageUrls.$inject=["apiFactory","$stateParams"],gallery.config(["$stateProvider",function(a){a.state("gallery",{"abstract":!0,templateUrl:"components/gallery/gallery.html"}).state("gallery.views",{url:"/{gallery:shades-of-gray|color}",views:{"left@gallery":{templateUrl:"components/gallery/partials/gallery-slick.html",controller:"SliderController"},"right@gallery":{templateUrl:"components/gallery/partials/gallery-img.html",controller:"GalleryImgController"}},resolve:{drawings:getImageUrls}})}]).controller("SliderController",["$scope","drawings",function(a,b){a.drawings=b.data.gallery,a.loadedDrawings=[],a.loaded=!1,a.changeImg=function(b){a.$parent.$broadcast("galleryImageSwitch",b)},a.changeInfo=function(b){a.$parent.$broadcast("sliderHover",b)}}]).controller("GalleryImgController",["$scope","drawings",function(a,b){a.currentDrawing=b.data.gallery[0],a.$on("galleryImageSwitch",function(b,c){a.currentDrawing=c}),a.$on("sliderHover",function(b,c){a.$parent===b.targetScope&&(a.hoverDrawing=c)})}]).directive("hoverInfo",function(){return{restrict:"E",replace:!0,scope:{drawing:"="},template:'<div class="img-info" ng-cloak>    <b>{{drawing.title}}</b>  &nbsp&nbsp {{drawing.dimensions}} &nbsp&nbsp{{drawing.medium}}</div>'}}).directive("galleryImg",["$timeout","$window",function(a,b){return{restrict:"E",replace:!0,transclude:!0,scope:{drawing:"=",index:"=",filter:"="},template:'<img ng-src="{{drawing.url | filter}}" alt="{{drawing.title}}" ng-class="tallOrWide()">',controller:["$scope",function(a){a.tallOrWide=function(){var b=Number(a.drawing.height)>Number(a.drawing.width);return{tall:b,wide:!b}}}],link:function(b,c,d){b.$watch("drawing",function(b,d){b!==d&&(c.addClass("fadeIn"),a(function(){c.removeClass("fadeIn")},450))})}}}]).directive("scrollPane",["$timeout","$window",function(a,b){return{restrict:"EA",transclude:!0,replace:!0,template:'<div class="scroll-pane slide-up"><div ng-transclude></div></div>',scope:{length:"@"},controller:["$scope","$element","$attrs",function(a,b,c){a.loaded=!1,a.numLoaded=0,this.addLoadedDrawing=function(){a.numLoaded++,a.numLoaded==a.length&&(a.loaded=!0,a.$apply())}}],link:function(c,d,e){var f=angular.element(b),g=!1,h=!1;c.$watch(function(){return f.width()},function(a,b){1200>=a&&b>1200?(h=!0,g=!0):a>1200&&1200>=b?(h=!1,g=!0):g=!1}),f.bind("resize",function(){c.$apply(function(){g&&h?c.pane.destroy():g&&!h&&(d.jScrollPane({animateScroll:!0,autoreinitialize:!0}),c.pane=d.data("jsp"))})}),c.$watch("loaded",function(b){b&&f.width()>1200&&(d.jScrollPane({animateScroll:!0,autoreinitialize:!0}),c.pane=d.data("jsp"),a(function(){d.removeClass("hide-scroll")},100))})}}}]).directive("imageonload",function(){return{restrict:"A",require:"^scrollPane",link:function(a,b,c,d){b.bind("load",function(){d.addLoadedDrawing()})}}}),angular.module("wdonahoeart.home",["ui.router"]).config(["$stateProvider",function(a){a.state("home",{url:"/home",templateUrl:"components/home/home.html",controller:"HomeCtrl"})}]).controller("HomeCtrl",["$scope","apiFactory",function(a,b){a.messages=[],a.callUnprotected=function(){b.callUnprotected().then(function(b){a.messages.splice(0,0,b.data.message)},function(b){a.messages.splice(0,0,"There was an error with the server...")})},a.callProtected=function(){b.callProtected().then(function(b){a.messages.splice(0,0,b.data.message)},function(b){a.messages.splice(0,0,"You're not logged in!")})}}]),angular.module("wdonahoeart.jwtAuth",[]).factory("jwtAuthFactory",["$window",function(a){var b={};return b.parseJwt=function(b){var c=_.first(b.split(".")),d=c.replace("-","+").replace("_","/");return JSON.parse(a.atob(d))},b.storeToken=function(b,c){a.localStorage.jwtToken=b,a.localStorage.user=c},b.getToken=function(){return a.localStorage.jwtToken},b.getUser=function(){return a.localStorage.user},b.destroyAuth=function(){a.localStorage.removeItem("jwtToken"),a.localStorage.removeItem("user")},b.isAuthed=function(){var a=this.getToken(),b=this.getUser();if(a&&b){this.parseJwt(a);return!0}return!1},b}]),angular.module("wdonahoeart.landing",["ui.router"]).config(["$stateProvider",function(a){a.state("landing",{url:"/",templateUrl:"components/landing/landing.html",controller:"LandingCtrl as ctrl"})}]).controller("LandingCtrl",["$timeout",function(a){var b=this,c=5e3,d=0,e=!0;b.slides=[{src:"https://s3.amazonaws.com/wdonahoeart/BostonGirl_Landing.jpg",loaded:!1},{src:"https://s3.amazonaws.com/wdonahoeart/APearofHands_Landing.jpg",loaded:!1},{src:"https://s3.amazonaws.com/wdonahoeart/Olivia_Landing.jpg",loaded:!1},{src:"https://s3.amazonaws.com/wdonahoeart/BagLunch_Landing.jpg",loaded:!1},{src:"https://s3.amazonaws.com/wdonahoeart/IslandFairy_Landing.jpg",loaded:!1},{src:"https://s3.amazonaws.com/wdonahoeart/DistantCousins_Landing.jpg",loaded:!1}],b.setCurrentIndex=function(a){d=a},b.isCurrentIndex=function(a){return d===a},b.nextSlide=function(){e?e=!1:(b.slides[d].loaded=!1,d=d<b.slides.length-1?++d:0),b.slides[d].loaded=!0,a(b.nextSlide,c)},this.loadSlides=function(){a(b.nextSlide,0)},b.loadSlides()}]);var login=angular.module("wdonahoeart.login",["wdonahoeart.api","ui.router"]);login.config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"components/login/login.html",controller:"LoginCtrl"})}]).controller("LoginCtrl",["$scope","$http","$state","apiFactory",function(a,b,c,d){a.user={},a.login=function(b){d.login(a.user).then(function(a){c.go("home")},function(a){alert(a.data)})}}]),angular.module("wdonahoeart.text",["ngResource","ui.router"]).config(["$stateProvider",function(a){a.state("bio",{url:"/bio",templateUrl:"components/text/partials/bio.html"}).state("cv",{url:"/cv",templateUrl:"components/text/partials/cv.html"})}]),app.directive("fadeIn",function(){return{restrict:"A",link:function(a,b,c){b.on("load",function(){b.addClass("fadeIn")})}}}),app.directive("fadeOut",function(){return{restrict:"A",link:function(a,b,c){a.$watch("loading",function(a){a&&b.toggleClass("fadez")})}}}),app.directive("fileInput",["$parse",function(a){return{restrict:"EA",template:'<input type="file" />',replace:!0,link:function(b,c,d){var e=a(d.fileInput),f=e.assign,g=a(d.onChange),h=function(){b.$apply(function(){f(b,c[0].files[0]),g(b)})};c.bind("change",h)}}}]),app.directive("myLoginForm",function(){return{restrict:"E",scope:{name:"@",type:"@",field:"="},controller:"LoginCtrl",templateUrl:"shared/templates/myLoginForm.html",link:function(a,b,c){b.find("label").text(_.capitalize(c.name))}}}),app.directive("spinner",function(){return{restrict:"E",replace:!0,template:'<span class="spinner"><img class="img-responsive center-block" src="static/loading-spinning-bubbles.svg" /></span>',link:function(a,b,c){a.$watch("loading",function(a){a?$(b).show():$(b).hide()})}}});